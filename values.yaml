# BD SelfScan Default Configuration Values
# This file contains default configuration values for the BD SelfScan Helm chart

# Global configuration
global:
  namespace: "bd-selfscan-system"

# Chart metadata
nameOverride: ""
fullnameOverride: ""

# Container registry configuration
registry:
  imagePullSecrets: []

# RBAC configuration
rbac:
  create: true
  serviceAccount:
    create: true
    name: ""
    annotations: {}

# Black Duck configuration
blackduck:
  tokenSecretName: "blackduck-creds"
  trustCert: true
  connectionTimeout: 120
  readTimeout: 300

# On-demand scanning configuration (Phase 1)
onDemand:
  enabled: true

# Automated scanning configuration (Phase 2)
automated:
  enabled: false

# Scan target (for on-demand scanning)
scanTarget: ""

# Application configuration
applications: []

# ConfigMap configuration
configMap:
  applications:
    name: "bd-selfscan-applications"

# Scanner configuration
scanner:
  image: "ghcr.io/snps-steve/bd-selfscan/bd-selfscan:latest"  
  imagePullPolicy: "IfNotPresent"
  
  # Resource limits and requests
  resources:
    requests:
      memory: "2Gi"
      cpu: "500m"
      ephemeral-storage: "10Gi"
    limits:
      memory: "8Gi"
      cpu: "4"
      ephemeral-storage: "50Gi"
  
  # Job configuration
  job:
    backoffLimit: 3
    activeDeadlineSeconds: 3600
    ttlSecondsAfterFinished: 86400  # 24 hours
    parallelism: 1
    completions: 1
    # Pod-level security context - run as root for Black Duck operations
    securityContext:
      runAsUser: 0
      runAsGroup: 0
      fsGroup: 0
  
  # Container security context - more permissive for Black Duck scanning
  containerSecurityContext:
    allowPrivilegeEscalation: true  # BD scanning may need this
    readOnlyRootFilesystem: false   # Needed for temp files
    runAsUser: 0                    # Ensure container runs as root
    capabilities:
      add:                          # Capabilities needed for scanning
        - CHOWN
        - DAC_OVERRIDE
        - FOWNER
        - SETGID
        - SETUID
        - SYS_ADMIN
      drop:
        - NET_RAW
  
  # Node selection
  nodeSelector: {}
  tolerations: []
  affinity: {}
  
  # Docker socket access (if needed for container operations)
  dockerSocket:
    enabled: false

# Scanning configuration
scanning:
  projectTier: 3
  policyFailSeverities: "CRITICAL,BLOCKER"
  imageDownloadTimeout: 600
  imageDownloadRetries: 3
  scanTimeout: 1800
  maxConcurrentScans: 3
  maxConcurrentDownloads: 2
  cleanupInterval: 7200
  keepSuccessfulJobs: 5
  keepFailedJobs: 10

# Debug configuration
debug:
  enabled: true                     # Good for initial troubleshooting
  logLevel: "INFO"                  # DEBUG, INFO, WARNING, ERROR
  keepTempFiles: false

# Monitoring configuration (Phase 2)
monitoring:
  enabled: false
  serviceMonitor:
    enabled: false
    namespace: ""
    labels: {}
    interval: "30s"
    scrapeTimeout: "10s"
  prometheusRule:
    enabled: false

# Controller configuration (Phase 2)
controller:
  enabled: false
  image: "python:3.11-slim"
  imagePullPolicy: "IfNotPresent"
  replicas: 1
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  nodeSelector: {}
  tolerations: []
  affinity: {}
  service:
    type: ClusterIP
    port: 8080
    targetPort: 8080
  metrics:
    enabled: true
    port: 8080
    path: "/metrics"
  health:
    enabled: true
    port: 8081
    path: "/health"
    readiness:
      initialDelaySeconds: 5
      periodSeconds: 5
    liveness:
      initialDelaySeconds: 30
      periodSeconds: 10

# Scheduled scanning configuration (Phase 2)
scheduled:
  enabled: false
  jobs: []

# Network policy configuration
networkPolicy:
  enabled: false
  ingress: []
  egress: []

# Resource quota management 
resourceQuota:
  enabled: false
  hard:
    limits.cpu: "16"
    limits.memory: "64Gi"
    limits.ephemeral-storage: "500Gi"
    persistentvolumeclaims: "0"
    requests.cpu: "8"
    requests.memory: "32Gi"

# Pod disruption budget (for Phase 2 controller)
podDisruptionBudget:
  enabled: false
  minAvailable: 1